# Vulnerability Intelligence (OSV.dev Integration)

Flowlyt includes **experimental vulnerability intelligence** capabilities powered by [OSV.dev](https://osv.dev), the Open Source Vulnerability database. This feature enhances security findings with real-world vulnerability data, CVE correlations, and risk scoring.

## Overview

The vulnerability intelligence feature:
- **Correlates findings** with known vulnerabilities from OSV.dev
- **Provides CVE mappings** for affected packages and actions
- **Enhances risk scoring** based on vulnerability data
- **Delivers actionable intelligence** about security threats
- **Supports multiple ecosystems** (GitHub Actions, npm, PyPI, Docker, etc.)

## Usage

### Enable Vulnerability Intelligence

```bash
# Basic scan with vulnerability intelligence
flowlyt scan --repo /path/to/repo --enable-vuln-intel

# Organization analysis with intelligence
flowlyt analyze-org --organization myorg --enable-vuln-intel

# High-severity findings with intelligence
flowlyt scan --repo . --enable-vuln-intel --min-severity HIGH --output json
```

### Sample Output

#### CLI Output with Intelligence
```
üß† VULNERABILITY INTELLIGENCE
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Data Source:          OSV.dev
Queries Performed:    17
Vulnerabilities Found: 3
High-Risk Findings:   5
CVEs Identified:      CVE-2023-12345, GHSA-abcd-1234-efgh

Intelligence Levels:
  HIGH: 3
  MEDIUM: 8
  LOW: 4
  NONE: 2

Risk Score Distribution:
  Critical (80-100): 3
  High (60-79): 9
  Medium (40-59): 5
  Low (20-39): 0
```

#### JSON Output Structure
```json
{
  "vulnerability_intelligence": {
    "enabled": true,
    "query_time": "2025-08-30T12:00:00Z",
    "queries_performed": 17,
    "vulnerabilities_found": 3,
    "high_risk_findings": 5,
    "cves_found": ["CVE-2023-12345", "GHSA-abcd-1234-efgh"],
    "data_source": "OSV.dev"
  },
  "enhanced_findings": [
    {
      "RuleID": "UNPINNED_ACTION",
      "vulnerability_info": {
        "cve_id": "CVE-2023-12345",
        "ghsa_id": "GHSA-abcd-1234-efgh",
        "summary": "GitHub Action vulnerable to supply chain attack",
        "severity": "HIGH",
        "score": "7.5",
        "published": "2023-06-15T10:00:00Z",
        "references": ["https://github.com/advisories/GHSA-abcd-1234-efgh"],
        "ecosystem": "GitHub Actions",
        "package_name": "vulnerable/action"
      },
      "risk_score": 85,
      "intelligence_level": "HIGH"
    }
  ]
}
```

## Intelligence Features

### üîç Vulnerability Correlation

The system analyzes findings and correlates them with OSV.dev data by:

1. **Package Extraction**: Identifies packages from evidence (GitHub Actions, npm, Docker, etc.)
2. **CVE Detection**: Finds CVE/GHSA IDs mentioned in code
3. **Pattern Matching**: Correlates vulnerability patterns with finding categories
4. **Severity Assessment**: Maps CVSS scores to enhanced risk levels

### üìä Risk Scoring Enhancement

Standard findings receive base scores, enhanced with vulnerability intelligence:

| Component | Base Score | Intelligence Bonus |
|-----------|------------|-------------------|
| **Severity** | 5-40 points | Based on finding severity |
| **Category** | 10-20 points | Malicious patterns get highest |
| **CVE Presence** | +15 points | Known vulnerability identified |
| **CVSS Score** | +5-30 points | Based on vulnerability severity |
| **Recency** | +10 points | Published within last year |

### üéØ Intelligence Levels

| Level | Description | Criteria |
|-------|-------------|----------|
| **HIGH** | Critical vulnerability with CVE | CVE ID + Critical severity |
| **MEDIUM** | Known vulnerability or high severity | CVE ID OR High severity |
| **LOW** | Vulnerability information available | Basic vulnerability data |
| **NONE** | No vulnerability correlation found | No matching data in OSV.dev |

## Supported Ecosystems

### GitHub Actions
- Extracts action names from `uses:` statements
- Queries for supply chain vulnerabilities
- Identifies malicious or compromised actions

```yaml
- uses: vulnerable/action@v1.0  # ‚ö†Ô∏è May trigger vulnerability lookup
```

### Package Managers

#### npm/Node.js
```bash
npm install vulnerable-package  # ‚ö†Ô∏è Queries npm ecosystem
yarn add risky-module          # ‚ö†Ô∏è Checks for known vulnerabilities
```

#### Python/PyPI
```bash
pip install unsafe-package     # ‚ö†Ô∏è Searches PyPI vulnerabilities
```

#### Docker
```dockerfile
FROM vulnerable:latest         # ‚ö†Ô∏è Checks Docker Hub vulnerabilities
```

### Direct CVE References
```yaml
# CVE-2023-12345 affects this workflow
- run: echo "Known vulnerability"  # ‚ö†Ô∏è Direct CVE correlation
```

## Performance Considerations

### Query Optimization
- **Concurrent queries**: Multiple OSV.dev requests in parallel
- **Intelligent filtering**: Only queries relevant packages
- **Timeout protection**: 30-second timeout per scan
- **Graceful degradation**: Falls back to standard scan on API errors

### Rate Limiting
- Respects OSV.dev API limits
- Implements exponential backoff
- Caches results when possible (future enhancement)

## Security & Privacy

### Data Handling
- **No sensitive data sent**: Evidence is masked before queries
- **Minimal metadata**: Only package names and versions queried
- **No data retention**: Flowlyt doesn't store OSV.dev responses
- **Open source database**: OSV.dev is publicly available data

### API Communication
- **HTTPS only**: All OSV.dev communication encrypted
- **User-Agent identification**: Proper tool identification
- **No authentication required**: OSV.dev is public API

## Configuration

### Environment Variables
```bash
# Optional: Custom OSV.dev API endpoint
export OSV_API_URL="https://api.osv.dev"

# Optional: Request timeout (seconds)
export OSV_TIMEOUT="30"

# Optional: Disable intelligence for CI environments
export FLOWLYT_DISABLE_INTEL="true"
```

### Command Line Options
```bash
# Enable intelligence (experimental)
--enable-vuln-intel

# Combine with other options
--enable-vuln-intel --min-severity HIGH --output sarif
```

## Integration Examples

### GitHub Actions CI
```yaml
name: Security Scan with Intelligence
on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Run Enhanced Security Scan
      run: |
        flowlyt scan --repo . \
          --enable-vuln-intel \
          --output sarif \
          --output-file security-intel.sarif
          
    - name: Upload Enhanced SARIF
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: security-intel.sarif
        category: flowlyt-intelligence
```

### Enterprise Reporting
```bash
# Organization-wide intelligence scan
flowlyt analyze-org \
  --organization mycompany \
  --enable-vuln-intel \
  --output json \
  --output-file company-security-intel.json

# Process results with intelligence data
jq '.vulnerability_intelligence.cves_found[]' company-security-intel.json
```

### Risk-Based Filtering
```bash
# Only critical findings with known vulnerabilities
flowlyt scan --repo . \
  --enable-vuln-intel \
  --min-severity CRITICAL \
  --output cli | grep -A 10 "CVE-"
```

## Troubleshooting

### Common Issues

#### No Vulnerabilities Found
```
Vulnerabilities Found: 0
```
This is normal when:
- Scanning synthetic/test workflows
- Using well-maintained, secure actions
- No vulnerable packages detected

#### API Connection Errors
```
Warning: Failed to enhance findings with vulnerability intelligence: connection timeout
```
Solutions:
- Check internet connectivity
- Verify OSV.dev API status
- Use `--no-vuln-intel` to disable temporarily

#### Slow Performance
```
‚è±Ô∏è Intelligence queries taking too long
```
Optimizations:
- Use `--min-severity HIGH` to reduce queries
- Scan specific workflows instead of entire repos
- Check network latency to OSV.dev

### Debug Mode
```bash
# Enable verbose output for debugging
flowlyt scan --repo . --enable-vuln-intel --verbose

# Check OSV.dev API manually
curl -X POST https://api.osv.dev/v1/query \
  -H "Content-Type: application/json" \
  -d '{"package":{"ecosystem":"GitHub Actions","name":"actions/checkout"}}'
```

## Future Enhancements

### Planned Features
- **Local vulnerability database**: Cache OSV.dev data locally
- **Custom intelligence sources**: Support for proprietary vulnerability feeds
- **Advanced correlation**: ML-based pattern matching
- **Risk trending**: Track vulnerability risk over time
- **Remediation suggestions**: Automated fix recommendations

### Contributing
The vulnerability intelligence feature is experimental. Contributions welcome:
- **Ecosystem support**: Add new package manager detection
- **Performance optimizations**: Improve query efficiency
- **Correlation accuracy**: Enhance vulnerability matching
- **Documentation**: Improve usage examples

## Resources

### OSV.dev Documentation
- **API Reference**: https://osv.dev/docs/
- **Vulnerability Database**: https://osv.dev/list
- **Schema Documentation**: https://ossf.github.io/osv-schema/

### Related Projects
- **OSV-Scanner**: Google's official OSV.dev scanner
- **Dependabot**: GitHub's dependency vulnerability scanner
- **Snyk**: Commercial vulnerability intelligence platform

### Standards & References
- **CVE Database**: https://cve.mitre.org/
- **GHSA Database**: https://github.com/advisories
- **CVSS Scoring**: https://www.first.org/cvss/
